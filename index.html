<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebMCP Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.5;
        }
        h1 {
            color: #333;
        }
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        code {
            background-color: #eee;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
        pre {
            background-color: #f8f8f8;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        button {
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0069d9;
        }
    </style>
</head>
<body>
    <h1>WebMCP Example</h1>

    <div class="demo-section">
        <h2>About WebMCP</h2>
        <p>WebMCP is a JavaScript library that allows any website to integrate with the Model Context Protocol.
           It provides a small widget in the corner of your page that allows users to interact with your webpage via LLM or agent.</p>
        <p>The widget appears as a small blue square in the bottom right corner. Click it to expand and connect using a token.</p>
    </div>

    <div class="demo-section">
        <h2>Getting Started</h2>
        <p>To use WebMCP, simply include the script on your page:</p>
        <pre><code>&lt;script src="webmcp.js"&gt;&lt;/script&gt;</code></pre>
        <p>The WebMCP widget will automatically initialize and appear in the bottom right corner of your page.</p>
    </div>

    <div class="demo-section">
        <h2>Registering tools</h2>
        <span>Tools are registered via calling <pre style="display: inline"><code>registerTool</code></pre>.</span>
        <pre><code>// Initialize with custom options
const mcp = new WebMCP({
    color: '#4CAF50',
    position: 'top-right',
    size: '40px',
    padding: '15px'
});

// Register custom tools
mcp.registerTool(
    'weather',
    'Get weather information',
    {
        location: { type: "string" }
    },
    function(args) {
        return `Weather for ${args.location}: Sunny, 22°C`;
    }
);</code></pre>

        <span>To provide the best experience for users, it is recommended to register all tools directly after loading
            <pre style="display: inline"><code>&lt;script src="webmcp.js"&gt;&lt;/script&gt;</code></pre>,
            as MCP clients may need to be restarted to get the available tools.
        </span>
        <p>For the sake of demonstration, the below can be clicked to dynamically register a new tool:</p>
        <button id="register-weather">Register Weather Tool</button>
        <button id="register-time">Register Time Tool</button>
    </div>

    <div class="demo-section">
        <h2>Connect to WebMCP Server</h2>
        <p>To use WebMCP with a model, you need to:</p>
        <ol>
            <li>Start the WebMCP server: <code>npm run start-ws-server</code></li>
            <li>Generate a connection token: <code>npm run authorize</code></li>
            <li>Click the blue square in the corner and paste the token</li>
            <li>Start the MCP client: <code>npm run start-mcp-client</code></li>
        </ol>
    </div>

    <!-- Load WebMCP script -->
    <script src="src/webmcp.js"></script>

    <!-- Demo script -->
    <script>
        // Get reference to WebMCP instance (automatically created)
        window.webMCP = new WebMCP();
        const mcp = window.webMCP;

        // Register some default tools for demo purposes
        if (mcp) {
            // Calculator tool
            mcp.registerTool(
                'calculator',
                'Performs basic math operations',
                {
                    type: "object",
                    properties: {
                        a: {type: "number"},
                        b: {type: "number"},
                        operation: {
                            type: "string",
                            enum: ["add", "subtract", "multiply", "divide"]
                        }
                    }
                },
                // Execute, then convert it to a string.
                (args) => {
                    const output = ((function (args) {
                        const {operation, a, b} = args;

                        switch (operation) {
                            case 'add':
                                return a + b;
                            case 'subtract':
                                return a - b;
                            case 'multiply':
                                return a * b;
                            case 'divide':
                                if (b === 0) throw new Error('Division by zero');
                                return a / b;
                            default:
                                throw new Error(`Unknown operation: ${operation}`);
                        }
                    })(args));
                    return {
                        content: [{
                            type: "text",
                            text: output.toString()
                        }]
                    }
                }
            );

            // Echo tool
            mcp.registerTool(
                'echo',
                'Echoes back the input message',
                {
                    type: "object",
                    properties: {
                        message: { type: "string" }
                    }
                },
                function (args) {
                    return {
                        content: [{
                            type: "text",
                            text: args.message
                        }]
                    }
                }
            );
        }

        // Weather tool registration
        document.getElementById('register-weather').addEventListener('click', function() {
            mcp.registerTool(
                'weather',
                'Get weather information for a location',
                {
                    type: "object",
                    properties: {
                        location: { type: "string" }
                    }
                },
                function(args) {
                    return {
                        content: [{
                            type: "text",
                            text: `Weather for ${args.location}: Sunny, 22°C`,
                        }]
                    }
                }
            );
            alert('Weather tool registered!');
        });

        // Time tool registration
        document.getElementById('register-time').addEventListener('click', function() {
            mcp.registerTool(
                'time',
                'Get current time for a timezone',
                {
                    type: "object",
                    properties: {
                        timezone: {
                            type: "string",
                            enum: ["UTC", "EST", "PST", "local"]
                        }
                    }
                },
                function(args) {
                    const now = new Date();
                    let timeStr;

                    switch(args.timezone) {
                        case 'UTC':
                            timeStr = now.toUTCString();
                            break;
                        case 'EST':
                            timeStr = now.toLocaleString('en-US', { timeZone: 'America/New_York' });
                            break;
                        case 'PST':
                            timeStr = now.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' });
                            break;
                        case 'local':
                        default:
                            timeStr = now.toLocaleString();
                            break;
                    }

                    return {
                        content: [{
                            type: "text",
                            text: `Current time (${args.timezone}): ${timeStr}`
                        }]
                    }
                }
            );
            alert('Time tool registered!');
        });
    </script>
</body>
</html>
